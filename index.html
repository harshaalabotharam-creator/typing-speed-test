<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Typing Speed Test Pro</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg: #0f172a;
  --card: #1e293b;
  --text: #e2e8f0;
  --accent: #2563eb;
  --accent-light: #3b82f6;
  --error: #ef4444;
  --success: #22c55e;
}
.light {
  --bg: #f8fafc;
  --card: #ffffff;
  --text: #1e293b;
  --accent: #2563eb;
  --accent-light: #3b82f6;
}

* { box-sizing: border-box; margin: 0; padding: 0; font-family: "Inter", sans-serif; }

body {
  background: var(--bg);
  color: var(--text);
  transition: background .5s, color .5s;
  overflow-x: hidden;
}

.container {
  max-width: 900px;
  margin: 50px auto;
  padding: 25px;
  background: var(--card);
  border-radius: 15px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.4);
  position: relative;
}

h1 { text-align: center; margin-bottom: 20px; font-weight: 700; font-size: 2em; }

.top-bar {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 15px;
}

button, select {
  padding: 8px 16px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background: var(--accent);
  color: #fff;
  font-size: 14px;
  transition: .2s;
}
button:hover, select:hover { background: var(--accent-light); }

.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
  gap: 15px;
  margin: 15px 0;
  font-size: 16px;
}

#text-display {
  border: 1px solid #334155;
  padding: 20px;
  border-radius: 10px;
  min-height: 130px;
  line-height: 1.8;
  font-size: 18px;
  background: var(--bg);
  transition: all .4s ease;
  word-break: break-word;
  position: relative;
  overflow: hidden;
}

#text-display span {
  transition: all .2s ease;
}

.correct { color: var(--success); transform: scale(1.1); }
.incorrect { color: var(--error); text-decoration: underline; transform: scale(1.05); }
.active { border-bottom: 2px solid var(--accent); animation: pulse 0.8s infinite; }

@keyframes pulse {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-2px); }
}

textarea {
  width: 100%;
  height: 110px;
  margin-top: 18px;
  padding: 14px;
  font-size: 17px;
  border-radius: 8px;
  border: 1px solid #334155;
  outline: none;
  transition: border .3s;
}
textarea:focus { border-color: var(--accent-light); }

.chart-container {
  margin-top: 25px;
  background: var(--card);
  padding: 20px;
  border-radius: 12px;
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

#background-anim {
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  background: linear-gradient(-45deg, #0f172a, #1e293b, #2563eb, #3b82f6);
  background-size: 400% 400%;
  animation: gradientBG 20s ease infinite;
  filter: blur(50px);
  opacity: 0.3;
}

@keyframes gradientBG {
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
</style>
</head>

<body>

<div id="background-anim"></div>

<div class="container">

  <div class="top-bar">
    <button id="themeToggle">üåô Theme</button>
  </div>

  <h1>Typing Speed Test Pro</h1>

  <div class="stats">
    <div>
      Time:
      <select id="timeSelect">
        <option value="30">30s</option>
        <option value="60" selected>60s</option>
        <option value="120">120s</option>
      </select>
    </div>
    <div>Time Left: <span id="time">60</span>s</div>
    <div>WPM: <span id="wpm">0</span></div>
    <div>Accuracy: <span id="accuracy">100</span>%</div>
    <div>Best: <span id="best">0</span> WPM</div>
  </div>

  <div id="text-display"></div>
  <textarea id="text-input" disabled placeholder="Start typing..."></textarea>
  <button id="restart">Restart</button>

  <div class="chart-container">
    <canvas id="scoreChart"></canvas>
  </div>

</div>

<script>
// ===== CORE LOGIC =====
const body = document.body;
const textDisplay = document.getElementById("text-display");
const textInput = document.getElementById("text-input");
const timeEl = document.getElementById("time");
const wpmEl = document.getElementById("wpm");
const accuracyEl = document.getElementById("accuracy");
const restartBtn = document.getElementById("restart");
const themeToggle = document.getElementById("themeToggle");
const timeSelect = document.getElementById("timeSelect");
const bestEl = document.getElementById("best");

const paragraphs = [
  "Consistency is the key to improving your typing speed.",
  "Frontend developers transform ideas into interactive experiences.",
  "Clean code and good design go hand in hand.",
  "Practice typing daily to build muscle memory.",
  "Smooth animations make user experience more delightful."
];

let timer, timeLeft, maxTime, charIndex, mistakes, isTyping;
let scores = JSON.parse(localStorage.getItem("scores")) || [];

// Animated counters
function animateValue(element, start, end, duration) {
  let range = end - start;
  let current = start;
  const increment = range / (duration / 50);
  const timer = setInterval(() => {
    current += increment;
    if ((increment>0 && current>=end) || (increment<0 && current<=end)) {
      current=end;
      clearInterval(timer);
    }
    element.innerText = Math.round(current);
  },50);
}

function setBest() { bestEl.innerText = localStorage.getItem("bestWPM") || 0; }

function getRandomSentence() { return paragraphs[Math.floor(Math.random()*paragraphs.length)]; }

function loadText(sentence=null) {
  if (!sentence) sentence=getRandomSentence();
  charIndex=0; mistakes=0;

  textDisplay.style.opacity=0;
  setTimeout(()=>{
    textDisplay.innerHTML="";
    sentence.split("").forEach((char,i)=>{
      const span=document.createElement("span");
      span.innerText=char;
      if(i===0) span.classList.add("active");
      textDisplay.appendChild(span);
    });
    textDisplay.style.opacity=1;
  },150);

  textInput.value="";
  textInput.disabled=false;
  textInput.focus();
}

function startTimer() {
  timer=setInterval(()=>{
    if(timeLeft>0){
      timeLeft--;
      timeEl.innerText=timeLeft;
    } else endTest();
  },1000);
}

function endTest() {
  clearInterval(timer);
  textInput.disabled=true;
  const wpm=parseInt(wpmEl.innerText);
  scores.push(wpm);
  localStorage.setItem("scores",JSON.stringify(scores));
  const best=Math.max(wpm, localStorage.getItem("bestWPM")||0);
  localStorage.setItem("bestWPM",best);
  setBest();
  updateChart();
}

textInput.addEventListener("input",()=>{
  const chars=textDisplay.querySelectorAll("span");
  const typed=textInput.value[charIndex];

  if(!isTyping){ startTimer(); isTyping=true; }

  chars.forEach(s=>s.classList.remove("active"));

  if(typed===chars[charIndex]?.innerText){
    chars[charIndex].classList.add("correct");
  } else {
    chars[charIndex].classList.add("incorrect");
    mistakes++;
  }

  charIndex++;
  if(chars[charIndex]) chars[charIndex].classList.add("active");

  // Auto-load next sentence with fade animation
  if(charIndex>=chars.length){
    setTimeout(()=>loadText(),200);
    return;
  }

  const correct=charIndex-mistakes;
  const wpm=Math.round((correct/5)/((maxTime-timeLeft)/60)||0);
  const acc=Math.round((correct/charIndex)*100||100);
  animateValue(wpmEl,parseInt(wpmEl.innerText),wpm,200);
  animateValue(accuracyEl,parseInt(accuracyEl.innerText),acc,200);
});

restartBtn.onclick=()=>{
  clearInterval(timer);
  maxTime=parseInt(timeSelect.value);
  timeLeft=maxTime;
  timeEl.innerText=timeLeft;
  animateValue(wpmEl,parseInt(wpmEl.innerText),0,200);
  animateValue(accuracyEl,parseInt(accuracyEl.innerText),100,200);
  isTyping=false;
  loadText();
};

// ===== Chart.js =====
let chart;
function updateChart(){
  if(chart) chart.destroy();
  const ctx=document.getElementById("scoreChart").getContext("2d");
  chart=new Chart(ctx,{
    type:'line',
    data:{
      labels:scores.map((_,i)=>`#${i+1}`),
      datasets:[{
        label:'WPM History',
        data:scores,
        borderColor:'var(--accent)',
        backgroundColor:'rgba(37,99,235,0.3)',
        tension:0.3
      }]
    },
    options:{responsive:true,scales:{y:{beginAtZero:true}}}
  });
}

// Theme toggle
themeToggle.onclick=()=>{
  body.classList.toggle("light");
  themeToggle.innerText=body.classList.contains("light")?"‚òÄÔ∏è Theme":"üåô Theme";
};

// Init
setBest();
maxTime=parseInt(timeSelect.value);
timeLeft=maxTime;
timeEl.innerText=timeLeft;
loadText();
updateChart();
</script>

</body>
</html>
