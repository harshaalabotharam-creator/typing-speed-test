<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TyperPro | Ghost Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #030712;
            --surface: rgba(17, 24, 39, 0.7);
            --border: rgba(255, 255, 255, 0.08);
            --accent: #8b5cf6;
            --accent-glow: rgba(139, 92, 246, 0.3);
            --ghost: rgba(255, 255, 255, 0.2);
            --text: #f3f4f6;
            --text-mute: #6b7280;
            --success: #10b981;
            --error: #ef4444;
        }

        .light {
            --bg: #f9fafb;
            --surface: rgba(255, 255, 255, 0.8);
            --border: rgba(0, 0, 0, 0.05);
            --accent: #6366f1;
            --text: #111827;
            --text-mute: #9ca3af;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Plus Jakarta Sans', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-x: hidden;
        }

        /* Abstract Glows */
        .glow-1 { position: fixed; top: -10%; left: -10%; width: 50vw; height: 50vw; background: var(--accent); filter: blur(150px); opacity: 0.1; z-index: -1; }
        .glow-2 { position: fixed; bottom: -10%; right: -10%; width: 40vw; height: 40vw; background: #3b82f6; filter: blur(150px); opacity: 0.1; z-index: -1; }

        .app-container {
            width: 90%;
            max-width: 1100px;
            background: var(--surface);
            backdrop-filter: blur(24px);
            border: 1px solid var(--border);
            border-radius: 32px;
            padding: 40px;
            box-shadow: 0 40px 100px -20px rgba(0,0,0,0.5);
        }

        /* Header & Dash */
        .dash {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: rgba(255,255,255,0.03);
            padding: 20px;
            border-radius: 20px;
            border: 1px solid var(--border);
            text-align: center;
            transition: 0.3s;
        }
        .metric-card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.05); }
        .metric-value { display: block; font-size: 2rem; font-weight: 800; color: var(--accent); font-family: 'JetBrains Mono'; }
        .metric-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-mute); }

        /* Typing Area */
        #typing-box {
            position: relative;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.6rem;
            line-height: 1.6;
            padding: 30px;
            background: rgba(0,0,0,0.2);
            border-radius: 24px;
            margin-bottom: 30px;
            min-height: 160px;
            cursor: text;
        }

        .char { color: var(--text-mute); position: relative; transition: 0.1s; }
        .char.correct { color: var(--text); }
        .char.incorrect { color: var(--error); background: rgba(239, 68, 68, 0.15); border-radius: 4px; }

        /* Carets */
        .caret {
            position: absolute;
            width: 2px;
            height: 1.5rem;
            background: var(--accent);
            box-shadow: 0 0 10px var(--accent);
            transition: all 0.1s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .ghost-caret {
            position: absolute;
            width: 2px;
            height: 1.5rem;
            background: var(--ghost);
            border: 1px dashed rgba(255,255,255,0.4);
            transition: all 0.5s linear;
            z-index: 1;
        }
        .ghost-label {
            position: absolute;
            top: -20px;
            font-size: 10px;
            white-space: nowrap;
            color: var(--text-mute);
        }

        /* Controls */
        .actions { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .btn-group { display: flex; gap: 10px; }
        
        button {
            padding: 12px 24px;
            border-radius: 14px;
            border: none;
            background: var(--accent);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
        }
        button:hover { opacity: 0.9; transform: scale(1.02); }
        button.secondary { background: rgba(255,255,255,0.05); color: var(--text); }

        select {
            background: transparent;
            color: var(--text);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: 10px;
            outline: none;
        }

        #hidden-input { position: absolute; opacity: 0; pointer-events: none; }

        .chart-container { height: 250px; width: 100%; margin-top: 20px; }

        .progress-container {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.05);
            border-radius: 2px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        #progress-bar {
            height: 100%;
            width: 0%;
            background: var(--accent);
            transition: 0.3s;
        }
    </style>
</head>
<body>

<div class="glow-1"></div>
<div class="glow-2"></div>

<div class="app-container">
    <div class="actions">
        <h2 style="font-weight: 800; letter-spacing: -1px;">TYPER<span style="color:var(--accent)">PRO</span></h2>
        <div class="btn-group">
            <select id="timeSelect">
                <option value="15">15s</option>
                <option value="30">30s</option>
                <option value="60" selected>60s</option>
            </select>
            <button class="secondary" id="themeBtn">ðŸŒ“</button>
            <button id="restartBtn">Reset</button>
        </div>
    </div>

    <div class="dash">
        <div class="metric-card">
            <span class="metric-label">Time Remaining</span>
            <span class="metric-value" id="timer">60</span>
        </div>
        <div class="metric-card">
            <span class="metric-label">WPM (Net)</span>
            <span class="metric-value" id="wpm">0</span>
        </div>
        <div class="metric-card">
            <span class="metric-label">Accuracy</span>
            <span class="metric-value" id="accuracy">100%</span>
        </div>
        <div class="metric-card">
            <span class="metric-label">Best WPM</span>
            <span class="metric-value" id="bestWpm">0</span>
        </div>
    </div>

    <div class="progress-container"><div id="progress-bar"></div></div>

    <div id="typing-box" onclick="focusInput()">
        <div id="ghost-caret" class="ghost-caret">
            <span class="ghost-label">PB Ghost</span>
        </div>
        <div id="caret" class="caret"></div>
        <div id="text-render"></div>
    </div>

    <input type="text" id="hidden-input" autocomplete="off">

    <div class="chart-container">
        <canvas id="mainChart"></canvas>
    </div>
</div>

<script>
    const textRender = document.getElementById('text-render');
    const hiddenInput = document.getElementById('hidden-input');
    const caret = document.getElementById('caret');
    const ghostCaret = document.getElementById('ghost-caret');
    const timerEl = document.getElementById('timer');
    const wpmEl = document.getElementById('wpm');
    const accuracyEl = document.getElementById('accuracy');
    const progressEl = document.getElementById('progress-bar');

    const sentenceBank = [
        "Consistency is the key to improving your typing speed and accuracy.",
        "Frontend developers transform complex ideas into interactive user experiences.",
        "Clean code and good design go hand in hand for modern web applications.",
        "Practice typing daily to build muscle memory and increase productivity.",
        "Smooth animations and fluid transitions make user experience more delightful.",
        "The quick brown fox jumps over the lazy dog in a silent forest.",
        "Programming is the art of telling a computer what to do precisely.",
        "Stay focused and maintain a steady rhythm to achieve high performance."
    ];
    
    let timer, timeLeft, maxTime;
    let charIndex = 0;
    let totalMistakes = 0;
    let totalCharsTyped = 0;
    let isStarted = false;
    let bestWpm = localStorage.getItem('pro_best') || 0;
    
    // Graph reliability: Store live WPM per second
    let liveDataPoints = [];
    let liveLabels = [];

    function init() {
        clearInterval(timer);
        maxTime = parseInt(document.getElementById('timeSelect').value);
        timeLeft = maxTime;
        charIndex = 0;
        totalMistakes = 0;
        totalCharsTyped = 0;
        isStarted = false;
        liveDataPoints = [0];
        liveLabels = ["0s"];
        
        timerEl.innerText = timeLeft;
        wpmEl.innerText = '0';
        accuracyEl.innerText = '100%';
        progressEl.style.width = '0%';
        document.getElementById('bestWpm').innerText = bestWpm;
        
        renderText();
        updateCaret();
        hiddenInput.value = "";
        hiddenInput.disabled = false;
        updateChart();
        moveGhost(0);
    }

    function renderText() {
        const quote = sentenceBank[Math.floor(Math.random() * sentenceBank.length)];
        textRender.innerHTML = quote.split("").map(c => `<span class="char">${c}</span>`).join("");
    }

    function updateCaret() {
        const chars = textRender.querySelectorAll('.char');
        const target = chars[charIndex];
        if(target) {
            caret.style.left = target.offsetLeft + 'px';
            caret.style.top = target.offsetTop + 'px';
        }
    }

    function moveGhost(progress) {
        const chars = textRender.querySelectorAll('.char');
        const ghostIndex = Math.floor(progress * chars.length);
        const target = chars[Math.min(ghostIndex, chars.length - 1)];
        if(bestWpm > 0 && target) {
            ghostCaret.style.opacity = "1";
            ghostCaret.style.left = target.offsetLeft + 'px';
            ghostCaret.style.top = target.offsetTop + 'px';
        } else {
            ghostCaret.style.opacity = "0";
        }
    }

    function focusInput() { hiddenInput.focus(); }

    hiddenInput.addEventListener('input', (e) => {
        if(!isStarted) {
            isStarted = true;
            startTimer();
        }

        const chars = textRender.querySelectorAll('.char');
        const typed = hiddenInput.value.split("");
        const currentTyped = typed[charIndex];

        if(e.inputType === "deleteContentBackward") {
            if(charIndex > 0) {
                charIndex--;
                totalCharsTyped--;
                chars[charIndex].classList.remove('correct', 'incorrect');
            }
        } else {
            if(chars[charIndex].innerText === currentTyped) {
                chars[charIndex].classList.add('correct');
            } else {
                chars[charIndex].classList.add('incorrect');
                totalMistakes++;
            }
            charIndex++;
            totalCharsTyped++;
        }

        // Infinite Logic: If sentence finished, load next without reset
        if(charIndex >= chars.length) {
            renderText();
            charIndex = 0;
            hiddenInput.value = "";
        }

        updateCaret();
        calculateLiveStats();
    });

    function calculateLiveStats() {
        const timeElapsed = maxTime - timeLeft;
        if(timeElapsed > 0) {
            const netWPM = Math.round(((totalCharsTyped - totalMistakes) / 5) / (timeElapsed / 60));
            wpmEl.innerText = Math.max(0, netWPM);
            const acc = Math.round(((totalCharsTyped - totalMistakes) / totalCharsTyped) * 100);
            accuracyEl.innerText = (acc || 100) + '%';
        }
        progressEl.style.width = (timeLeft / maxTime * 100) + '%';
    }

    function startTimer() {
        timer = setInterval(() => {
            if(timeLeft > 0) {
                timeLeft--;
                timerEl.innerText = timeLeft;
                
                const timeElapsed = maxTime - timeLeft;
                const currentWpm = parseInt(wpmEl.innerText);
                
                // Track data for the reliable graph
                liveLabels.push(timeElapsed + "s");
                liveDataPoints.push(currentWpm);
                updateChart();

                // Move Ghost based on PB
                const pbCharsPerSec = (bestWpm * 5) / 60;
                const charsInCurrentLine = textRender.querySelectorAll('.char').length;
                const pbProgressThisLine = (pbCharsPerSec * timeElapsed) % charsInCurrentLine;
                moveGhost(pbProgressThisLine / charsInCurrentLine);

            } else {
                endTest();
            }
        }, 1000);
    }

    function endTest() {
        clearInterval(timer);
        hiddenInput.disabled = true;
        const finalWpm = parseInt(wpmEl.innerText);
        if(finalWpm > bestWpm) {
            bestWpm = finalWpm;
            localStorage.setItem('pro_best', bestWpm);
        }
        document.getElementById('bestWpm').innerText = bestWpm;
    }

    let chart;
    function updateChart() {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: liveLabels,
                datasets: [{
                    label: 'Live WPM',
                    data: liveDataPoints,
                    borderColor: '#8b5cf6',
                    backgroundColor: 'rgba(139, 92, 246, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                animation: false, // Set to false for high performance during live stream
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#6b7280' } },
                    x: { grid: { display: false }, ticks: { color: '#6b7280' } }
                }
            }
        });
    }

    document.getElementById('restartBtn').onclick = init;
    document.getElementById('themeBtn').onclick = () => document.body.classList.toggle('light');
    
    window.onload = init;
</script>

</body>
</html>
