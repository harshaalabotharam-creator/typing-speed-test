<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Typing Speed Test Pro</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg: #0f172a;
  --card: #1e293b;
  --text: #e2e8f0;
  --accent: #2563eb;
  --accent-light: #3b82f6;
  --error: #ef4444;
  --success: #22c55e;
}
.light {
  --bg: #f8fafc;
  --card: #ffffff;
  --text: #1e293b;
  --accent: #2563eb;
  --accent-light: #3b82f6;
}

* { box-sizing: border-box; margin: 0; padding: 0; font-family: "Inter", sans-serif; }

body {
  background: var(--bg);
  color: var(--text);
  transition: background .3s, color .3s;
}

.container {
  max-width: 900px;
  margin: 30px auto;
  padding: 20px;
  background: var(--card);
  border-radius: 12px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  animation: fadeIn 0.5s ease-in-out;
}

h1 { text-align: center; margin-bottom: 12px; font-weight: 600; }

.top-bar {
  display: flex;
  justify-content: space-between; align-items: center;
  margin-bottom: 10px;
}

button, select {
  padding: 8px 14px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background: var(--accent);
  color: #fff;
  font-size: 14px;
  transition: .2s;
}
button:hover, select:hover { background: var(--accent-light); }

.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
  gap: 12px;
  margin: 12px 0;
  font-size: 16px;
}

#text-display {
  border: 1px solid #334155;
  padding: 18px;
  border-radius: 8px;
  min-height: 120px;
  line-height: 1.6;
  font-size: 18px;
  background: var(--bg);
  transition: border-color .3s;
}

.correct { color: var(--success); }
.incorrect { color: var(--error); text-decoration: underline; }
.active { border-bottom: 2px solid var(--accent); }

textarea {
  width: 100%;
  height: 100px;
  margin-top: 14px;
  padding: 12px;
  font-size: 16px;
  border-radius: 6px;
  border: 1px solid #334155;
  outline: none;
  transition: border .3s;
}
textarea:focus { border-color: var(--accent-light); }

.chart-container {
  margin-top: 22px;
  background: var(--card);
  padding: 18px;
  border-radius: 10px;
}

.fullscreen-btn {
  background: none;
  border: 1px solid var(--accent);
  padding: 6px 10px;
  font-size: 14px;
  border-radius: 6px;
  color: var(--accent);
}
.fullscreen-btn:hover {
  background: var(--accent);
  color: #fff;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>

<body>

<div class="container">

  <div class="top-bar">
    <h1>Typing Speed Test Pro</h1>
    <div>
      <button id="themeToggle">ðŸŒ™ Theme</button>
      <button class="fullscreen-btn" id="fsToggle">ðŸ–µ Full Screen</button>
    </div>
  </div>

  <div class="stats">
    <div>
      Time:
      <select id="timeSelect">
        <option value="30">30s</option>
        <option value="60" selected>60s</option>
        <option value="120">120s</option>
      </select>
    </div>
    <div>Time Left: <span id="time">60</span>s</div>
    <div>WPM: <span id="wpm">0</span></div>
    <div>Accuracy: <span id="accuracy">100</span>%</div>
    <div>Best: <span id="best">0</span> WPM</div>
  </div>

  <div id="text-display"></div>
  <textarea id="text-input" disabled placeholder="Start typing..."></textarea>
  <button id="restart">Restart</button>

  <div class="chart-container">
    <canvas id="scoreChart"></canvas>
  </div>

</div>

<script>
// ====== CORE LOGIC ======
const body = document.body;
const textDisplay = document.getElementById("text-display");
const textInput = document.getElementById("text-input");
const timeEl = document.getElementById("time");
const wpmEl = document.getElementById("wpm");
const accuracyEl = document.getElementById("accuracy");
const restartBtn = document.getElementById("restart");
const themeToggle = document.getElementById("themeToggle");
const timeSelect = document.getElementById("timeSelect");
const bestEl = document.getElementById("best");
const fsToggle = document.getElementById("fsToggle");

const paragraphs = [
  "Consistency is the key to improving your typing speed.",
  "Frontend developers transform ideas into interactive experiences.",
  "Clean code and good design go hand in hand.",
  "Practice typing daily to build muscle memory."
];

let timer, timeLeft, maxTime, charIndex, mistakes, isTyping;
let scores = JSON.parse(localStorage.getItem("scores")) || [];

function setBest() {
  bestEl.innerText = localStorage.getItem("bestWPM") || 0;
}

function loadText() {
  timeLeft = maxTime;
  charIndex = 0;
  mistakes = 0;
  isTyping = false;
  timeEl.innerText = timeLeft;

  const text = paragraphs[Math.floor(Math.random() * paragraphs.length)];
  textDisplay.innerHTML = "";
  text.split("").forEach((char, i) => {
    const span = document.createElement("span");
    span.innerText = char;
    if (i === 0) span.classList.add("active");
    textDisplay.appendChild(span);
  });
  textInput.value = "";
  textInput.disabled = false;
  textInput.focus();
}

function startTimer() {
  timer = setInterval(() => {
    if (timeLeft > 0) {
      timeLeft--;
      timeEl.innerText = timeLeft;
    } else endTest();
  }, 1000);
}

function endTest() {
  clearInterval(timer);
  textInput.disabled = true;
  const wpm = parseInt(wpmEl.innerText);
  scores.push(wpm);
  localStorage.setItem("scores", JSON.stringify(scores));

  const best = Math.max(wpm, localStorage.getItem("bestWPM") || 0);
  localStorage.setItem("bestWPM", best);
  setBest();
  updateChart();
}

textInput.addEventListener("input", () => {
  const chars = textDisplay.querySelectorAll("span");
  const typed = textInput.value[charIndex];

  if (!isTyping) { startTimer(); isTyping = true; }

  if (timeLeft === 0) return;

  chars.forEach(s => s.classList.remove("active"));

  if (typed === chars[charIndex]?.innerText) chars[charIndex].classList.add("correct");
  else { chars[charIndex].classList.add("incorrect"); mistakes++; }

  charIndex++;
  if (chars[charIndex]) chars[charIndex].classList.add("active");

  const correct = charIndex - mistakes;
  const wpm = Math.round((correct / 5) / ((maxTime - timeLeft) / 60));
  const acc = Math.round((correct / charIndex) * 100);

  wpmEl.innerText = wpm > 0 ? wpm : 0;
  accuracyEl.innerText = acc > 0 ? acc : 100;
});

restartBtn.onclick = () => {
  clearInterval(timer);
  maxTime = parseInt(timeSelect.value);
  loadText();
};

// ====== CHART.JS ======
let chart;
function updateChart() {
  if (chart) chart.destroy();
  const ctx = document.getElementById("scoreChart").getContext("2d");
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: scores.map((_,i) => `#${i+1}`),
      datasets: [{
        label: 'WPM History',
        data: scores,
        borderColor: 'var(--accent)',
        backgroundColor: 'rgba(37,99,235,0.3)',
        tension: 0.3
      }]
    }
  });
}

// ====== THEME & FULLSCREEN ======
themeToggle.onclick = () => {
  body.classList.toggle("light");
  themeToggle.innerText = body.classList.contains("light") ? "â˜€ï¸ Theme" : "ðŸŒ™ Theme";
};

fsToggle.onclick = () => {
  if (!document.fullscreenElement) document.documentElement.requestFullscreen();
  else document.exitFullscreen();
};

setBest();
maxTime = parseInt(timeSelect.value);
loadText();
updateChart();

</script>

</body>
</html>
